<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Medieval Fantasy Simulation v2.1.0 - Energy System</title>
  <style>
    body {
      margin: 0;
      background-color: #333;
      overflow: hidden;
      font-family: 'Times New Roman', serif;
    }
    canvas {
      display: block;
      cursor: pointer;
    }
    .stats-panel {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 10px;
      border-radius: 5px;
      pointer-events: none;
      font-size: 12px;
    }
    .left-stats {
      top: 10px;
      left: 10px;
      width: 220px;
    }
    .right-stats {
      top: 10px;
      right: 10px;
      width: 220px;
      text-align: right;
    }
    .stat-value {
      font-weight: bold;
    }
    .controls-panel {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      max-width: 60%;
    }
    .version-info {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 10px;
    }
    
    /* Energy indicators */
    .energy-high {
      color: #00FF00;
    }

    .energy-medium {
      color: #FFFF00;
    }

    .energy-low {
      color: #FF0000;
    }

    /* Tooltip styles for energy info */
    .tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 5px;
      border-radius: 5px;
      font-size: 12px;
      pointer-events: none;
      z-index: 100;
      max-width: 200px;
    }

    /* Energy legend */
    .energy-legend {
      position: absolute;
      bottom: 50px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .legend-color {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .run-color {
      background-color: rgba(255, 165, 0, 0.8);
    }

    .walk-color {
      background-color: rgba(144, 238, 144, 0.8);
    }

    .sleep-color {
      background-color: rgba(173, 216, 230, 0.8);
    }

    /* Enhanced alert for low energy */
    @keyframes pulse {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }

    .energy-critical {
      animation: pulse 1s infinite;
    }
  </style>
</head>
<body>
<div id="leftStats" class="stats-panel left-stats"></div>
<div id="rightStats" class="stats-panel right-stats"></div>
<div id="controls" class="controls-panel">Click on units to toggle stats display</div>
<div class="version-info">v2.1.0 - Energy System</div>
<canvas id="battleCanvas"></canvas>

<!-- Energy Legend -->
<div class="energy-legend">
  <h4 style="margin: 0 0 5px 0;">Energy System</h4>
  <div class="legend-item">
    <div class="legend-color run-color"></div>
    <span>Running</span>
  </div>
  <div class="legend-item">
    <div class="legend-color walk-color"></div>
    <span>Walking</span>
  </div>
  <div class="legend-item">
    <div class="legend-color sleep-color"></div>
    <span>Sleeping</span>
  </div>
  <div style="margin-top: 5px; font-size: 10px;">
    Units sleep to recover energy<br>
    33% chance when below 40 energy
  </div>
</div>

<!-- Tooltip for displaying unit info on hover -->
<div id="tooltip" class="tooltip" style="display: none;"></div>

<script src="constants.js"></script>
<script src="classes.js"></script>
<script src="main.js"></script>

<script>
// Update the controls panel
function updateControlsText() {
  document.getElementById('controls').innerHTML = `
    <div>
      <b>Unit Controls:</b> Click on units to toggle selection
    </div>
    <div style="margin-top: 5px;">
      <b>Energy System:</b>
      <ul style="margin: 2px 0 0 15px; padding: 0;">
        <li>Walking: ${WALK_ENERGY_COST * 100} energy/sec, ${Math.round(WALK_SPEED_MULTIPLIER * 100)}% speed</li>
        <li>Running: ${RUN_ENERGY_COST * 100} energy/sec, ${Math.round(RUN_SPEED_MULTIPLIER * 100)}% speed</li>
        <li>Sleep: Recovers ${ENERGY_RECOVERY_RATE * 60} energy/sec</li>
        <li>Units need ${LOW_ENERGY_THRESHOLD}+ energy to run</li>
      </ul>
    </div>
  `;
}

// Add tooltip functionality for hovering over units
canvas.addEventListener('mousemove', function(event) {
  const rect = canvas.getBoundingClientRect();
  const mouseX = event.clientX - rect.left;
  const mouseY = event.clientY - rect.top;
  
  let hoveredUnit = null;
  for (let unit of units) {
    if (unit.isPointInside(mouseX, mouseY)) {
      hoveredUnit = unit;
      break;
    }
  }
  
  const tooltip = document.getElementById('tooltip');
  
  if (hoveredUnit) {
    let energyClass = 'energy-high';
    if (hoveredUnit.energy < LOW_ENERGY_THRESHOLD) {
      energyClass = 'energy-low';
    } else if (hoveredUnit.energy < 70) {
      energyClass = 'energy-medium';
    }
    
    let statusText = hoveredUnit.isSleeping ? 'Sleeping' : 
                  (hoveredUnit.isMoving ? 
                    (hoveredUnit.movementMode === 'run' ? 'Running' : 'Walking') : 
                    'Idle');
    
    tooltip.innerHTML = `
      <div>${hoveredUnit.randomName} (Team: ${hoveredUnit.team})</div>
      <div>Status: ${statusText}</div>
      <div>Energy: <span class="${energyClass}">${Math.floor(hoveredUnit.energy)}/${hoveredUnit.maxEnergy}</span></div>
    `;
    
    tooltip.style.display = 'block';
    tooltip.style.left = (event.clientX + 10) + 'px';
    tooltip.style.top = (event.clientY + 10) + 'px';
  } else {
    tooltip.style.display = 'none';
  }
});

// Hide tooltip when mouse leaves canvas
canvas.addEventListener('mouseleave', function() {
  document.getElementById('tooltip').style.display = 'none';
});

// Initialize the controls panel
document.addEventListener('DOMContentLoaded', function() {
  updateControlsText();
});
</script>
</body>
</html>